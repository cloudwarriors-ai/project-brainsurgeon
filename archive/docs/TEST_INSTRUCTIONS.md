# Opencode TUI API Test Instructions

## Overview
A TUI API server has been created using the opencode SDK to connect to the TUI on localhost:6969. It provides tools to interact with the TUI interface.

The MCP server is configured in opencode.json as "opencode-bridge".

## MCP Server Details
- **File**: mcp_server.py
- **Tools**:
  - append_prompt: Append text to the TUI prompt.
  - submit_prompt: Submit the current prompt in the TUI.
  - clear_prompt: Clear the current prompt in the TUI.
  - show_toast: Show a toast notification in the TUI.
  - execute_command: Execute a command in the TUI (e.g., agent_cycle).
  - get_next_event: Get the next event from the TUI event stream.
  - **Event Handling**: Streams events from the opencode server at localhost:6969/event using HTTP streaming and queues them. get_next_event retrieves the next queued event.

## Configuration
The opencode.json configures the MCP server as a local tool. Restart opencode to load it.

## Testing Procedure
1. Ensure the TUI API server is running on port 6969.
2. The MCP server should start automatically when opencode loads the config.
3. In a session, use the agent to test tools:
   - Append to prompt: "Append 'Hello' to the TUI prompt."
   - Submit prompt: "Submit the current prompt in the TUI."
   - Clear prompt: "Clear the current prompt in the TUI."
   - Show toast: "Show a toast with message 'Test' and variant 'info'."
   - Execute command: "Execute 'agent_cycle' in the TUI."
   - Check events: "Get the next event." Repeat to see events generated by actions.
4. Events should include things like prompt changes, submissions, etc.
5. Verify the TUI responds accordingly.

## Expected Behavior
- Tools should work if TUI API server is accessible.
 - Events are streamed and queued; get_next_event should return recent events.
 - The agent can control the TUI interface and observe events.
 - Server runs on Python with FastMCP; ensure fastmcp is installed: pip3 install fastmcp.

## Notes
- If TUI API server is not running, tools will fail.
- This setup allows the agent to control the TUI.
- The server uses FastMCP; ensure the venv is set up with fastmcp installed.